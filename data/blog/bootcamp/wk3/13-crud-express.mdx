---
title: CRUD and Express
date: '2022-07-12'
tags: ['CRUD', 'Express']
images: ['/static/images/postImages/CRUD.jpg']
draft: false
summary: This is a brief summary of the CRUD operations and HTTP methods.
---

<TOCInline toc={props.toc} asDisclosure />

In Web Dev, we often have to manipulate data in some way. We can do so using the CRUD operations.

| CRUD Actions | Description         | Example                                       |
| ------------ | ------------------- | --------------------------------------------- |
| Create       | Create a new record | `user[123] = {fName: 'Curt', lName: 'Warcup}` |
| Read         | Read a record       | `user[123]`                                   |
| Update       | Update a record     | `user[123].fName = 'John'`                    |
| Delete       | Delete a record     | `delete user[123]`                            |

Having these CRUD operations ensures you can create, read, update, and delete data from your database.

## CRUD and HTTP

Recall that HTTP is the protocol used to facilitate communication between the interface and the database (with the browser and server in between).

```
|-client-|     |------- server -------|

          ----->            ----->
browser    HTTP    Server.js       Database
          <-----            <-----
```

When HTTP was first created, it was used to transfer data between the client and server. To get those requests, the client sent a request to the server. The server responded with a response. The request must use the appropriate HTTP method.

| HTTP Methods | CRUD Actions |
| ------------ | ------------ |
| GET          | Read         |
| POST         | Create       |
| PUT          | Update       |
| DELETE       | Delete       |

**Safe Methods**: GET, HEAD, OPTIONS, TRACE. Has no intended effect on the server. They are intended to be _read-only_ operations.

On the other hand, the following methods are _unsafe_: POST, PUT, DELETE. These methods can be used to modify the database.

## idempotent methods

A request method is **idempotent** if multiple identical requests with that method have the same effect as a single such request. PUT and DELETE are said to be idempotent. PUT and DELETE methods, meanwhile, are idempotent since **successive identical requests will be ignored**.

Sending an identical POST request multiple times may further modify the state of the server or have further effects, such as sending multiple emails. Therefore, POST is not idempotent.

In Summary:

- GET: Reads data from the database.
- POST: Create resources in the database.Use when updating in a non-idempotent way.
- PUT: Want to update some resources.
- DELETE: Delete resources from the database.

## CRUD with Express

We need to be able to do all the CRUD operations with Express.

Express docs: [here](http://expressjs.com/en/4x/api.html)

Recall the basic structure of an express app:

```js
const express = require('express')
const app = express()
const port = 8080

app.get('/', (req, res) => {
  res.send('Hello World!')
})

app.listen(port, () => {
  console.log(`Example app listening on port ${port}`)
})
```

## Side Note on nodemon

Allows you to automatically restart your server when you make changes to your code.

```bash
npm i nodemon
```

Update the package.json file:

```json
"start": "./node_modules/.bin/nodemon -L nameOfFile"
```

Then run the following command:

```bash
npm run start
```

## Setting up a route handler

If ever a use tries to access a specific path, we need to define a route handler.

```js
app.get('theRoute', (req, res) => {
  console.log('req', req)
})
```

> Therefore, whenever anybody tries to access the path `/theRoute`, the callback function will be called.

The `console.log('req', req);` returns a VERY large object. There are a ton of properties in this incoming object.

## How to Accept Values from an HTML form?

`Form` requires two things:

- `action`: this is the path on the server where the form will be submitted.
- `method`: is the HTTP verb associated with the form.

```html
<!-- in your ejs template -->
<!-- name is add.ejs -->
<p>use this form to add a new countdown:</p>
<form action="/milestones/new" method="POST">
  <label for="time">Time:</label>
  <input type="text" name="time" />

  <label for="description">Description:</label>
  <input type="text" name="description" />
  <input type="submit" name="submit-btn" value="Add" />
</form>
```

Need to create the `get` route handler. This is to just serve the forum view.

```js
app.get('/milestones/new', (req, res) => {
  res.render('add') // name of ejs file we want to serve from view
})
```

We need to create a way to handle to `post` request that accepts the data from the forum.

```js
app.post('/milestones/new', (req, res) => {
  console.log('req.body', req.body)
  res.redirect('/milestones')
})
```

> Our log will show the data that was submitted, however it is undefined.

We need to use middleware to handle the data.

```js
app.use(express.urlencoded({ extended: true }))
```

Now we can log the `req.body` object.

```bash
req.body {
  time: '35',
  description: 'wake up'
  }
```

> the **name** fields from our form that are passed into the `req.body` object.
> The value of that **name** on the object is the value of the input field.

Now we can actually work with the data that comes in with that `req.body` object.

```js
const someArr = []

app.post('/milestones/new', (req, res) => {
  console.log('req.body', req.body)
  // add some object into our array
  someArr.push({
    time: req.body.time,
    description: req.body.description,
  })
  res.redirect('/milestones')
})
```

In summary, the **name** field from our _form_ is the **key** in the object that is passed into the `req.body` object.

## How to Edit an entry

It is very similar to adding a new entry.

```js
app.get('/milestones/edit', (req, res) => {
  res.render('edit')
})

app.post('/milestones/edit', (req, res) => {
  console.log('req.body', req.body)
  res.redirect('/milestones')
})
```

```html
<!-- in your edit.ejs template -->
<p>use this form to EDIT countdown:</p>
<form action="/milestones/edit/<%= id %>" method="POST">
  <label for="time">Time:</label>
  <input type="text" name="time" />

  <label for="description">Description:</label>
  <input type="text" name="description" />

  <input type="submit" name="submit-btn" value="Add" />
</form>
```

How could we get the data from the database to automatically populate in the form?

### How to write a route that accepts dynamic values in the URL

Need to create a route that accepts dynamic values in the URL.

Here we use a `:` to indicate that we want to accept a dynamic value in the URL.

```js
app.get('/milestones/edit/:id', (req, res) => {
  console.log('req.params', req.params)
  const templateVars = {
    id: req.params.id,
    time: someArr[req.params.id].time,
    description: someArr[req.params.id].description,
  }
  res.render('edit')
})
```

### How to EDIT an entry

We can get the `id` we are looking for by using the `req.params` object.

```js
// if we went to localhost:8080/milestones/edit/1
req.params { id: '1' }

// access it like this:
req.params.id // 1
```

Can access this value in our `id` in the `get` request:

```js
app.get('/milestones/edit/:id', (req, res) => {
  const index = req.params.id
  // can access the item at a given index
  console.log('someArray', someArray[index])
  const templateVars = {
    time: someArray[index].time,
    description: someArray[index].description,
  }
  res.render('edit')
})
```

We need to use the `app.post` to handle the new, edited, data.

```js
app.post('/milestones/edit/:id', (req, res) => {
  const index = req.params.id
  someArray[index].time = req.body.time
  res.redirect('/milestones')
})
```

Recall, our edit.ejs:

```js
<form action='/milestones/edit/<%= id %>' method="POST">
```

## DELETE an entry

add notes
